pipeline {
    agent any
    
    stages {
        stage('Checkout') {
            steps {
                checkout([
                    $class: 'GitSCM',
                    branches: [[name: '*/develop']],
                    userRemoteConfigs: [[
                        url: 'git@github.com:LucasKoritar23/test-verse.git',
                        credentialsId: 'ssh-key-github'
                    ]]
                ])
            }
        }
        
        stage('Build') {
            steps {
                script {
                    sh 'npm install'
                }
            }
        }

    }
    
    post {
        success {
            // Enviar mensagem de sucesso para o Discord via webhook
            sh '''
                curl -X POST -H "Content-Type: application/json" -d '{
                    "embeds": [{
                        "title": "Build Status",
                        "description": "Build successful! :white_check_mark:",
                        "color": 65340,
                        "fields": [
                            {
                                "name": "Pipeline Name",
                                "value": "'${JOB_NAME}'"
                            },
                            {
                                "name": "Build ID",
                                "value": "${BUILD_ID}"
                            },
                            {
                                "name": "Pipeline URL",
                                "value": "${BUILD_URL}"
                            }
                        ]
                    }]
                }' "$DISCORD_WEBHOOK_URL"
            '''

        }
        
        failure {
            // Enviar mensagem de falha para o Discord via webhook
            sh 'curl -X POST -H "Content-Type: application/json" -d \'{"content": "Falha na build, testes ou deploy!"}\' ${DISCORD_WEBHOOK_URL}'
        }
    }
}
